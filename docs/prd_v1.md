## 개요

---

본 프로젝트는 제텔카스텐 방법론을 일기 작성에 적용하여 이용자가 작성한 일기로부터 아이디어를 얻고 추가적인 효용을 얻을 수 있도록 돕기 위해 기획되었다.
이용자는 "memo"라는 단위를 최소 단위로 하여 글을 작성할 수 있다. 또한 각각의 memo에는 entity를 추가할 수 있는데, 이는 보통의 노트앱의 "태그"와 유사한 기능을 한다.
이용자는 특정 entity를 클릭하여 해당 entity가 적용된 memo들을 모두 조회할 수 있으며, 이를 조회하면서 새로운 memo를 작성할 수 있다.
본 프로젝트는 클라우드를 기반으로 설계되었기 때문에 로컬에는 별도의 데이터를 저장하지 않으며, 각각의 memo들을 곧바로 DB에 저장한다.

## 기술 스택

---

- typescript
- NextJS
- React
- Supabase
- Vercel
- [[tanstack query]]
- Tailwind CSS
- Shadcn/ui

## 화면 구성

---

초기 구현 시에는 로그인/회원가입 페이지와 메인 페이지, 단 2개의 페이지만으로 구현.
로그인/회원가입 페이지에서는 로그인과 회원가입을 진행한다.
메인 페이지에서는 메모를 작성하고, 히스토리를 확인하고, 추천된 엔티티 목록을 조회할 수 있다.
각각을 메모 작성 섹션, 히스토리 섹션, 엔티티 목록 섹션이라고 칭하자.
메모 작성 섹션은 화면의 좌측 70%를 차지하고, 히스토리 섹션은 우측 30%를 차지한다.
메모 작성 섹션에는 input 창이 포함된다.
엔티티 목록 섹션은 메모 작성 섹션의 input창 위에 위치한다.

## 핵심 기능

---

### user 관련

---

- supabase OAuth를 통해 구현.
- 새로운 user가 가입 시 user Table에 새로이 추가.
- url이 변경되는 모든 순간에 로그인 상태를 점검하여, 로그인 상태가 아닐 경우 로그인 페이지로 강제 리다이렉트

### memo 관련

---

- memo, entity, memo_entity 테이블과 연관.
- 새로운 memo가 작성되면 memo 테이블에 추가. 이때, input 창의 내용에 대해 정규표현식으로 query를 작성하여, `@`로 시작하는 모든 단어를 추출한 뒤, 해당 내용과 동일한 이름의 entity가 존재하면 해당 entity의 ID를 memo_entity 테이블을 통해 memo와 연결한다.
- 우선적으로 CRUD 중 C, R만 구현. (수정과 삭제는 추후 구현 예정.)

### entity 관련

---

- 이용자가 메인 페이지에 진입 시 현재 유저의 전체 `Entity` 리스트(id, name)를 `Supabase`에서 조회하여 캐싱해둔다. 이때, tanstack query의 stale time을 3분으로 설정.
- 
    - 이용자가 memo에 들어갈 내용을 input 창에 입력하는 중에, `@`를 입력하면 entity 검색 활성화. (즉, 문자 `@`를 트리거로 사용)
- 유저가 `@` 뒤에 텍스트를 입력하면, 서버에 요청을 보내지 않고 **미리 로드된 리스트를 필터링**하여 추천 목록을 보여준다. (Zero Latency)
- `@` 뒤에 입력된 문자열을 기준으로 entity 테이블에서 일치하는 entity들을 검색.
    - 예를 들어, entity 테이블에 "project1", "project2", "project3", "hello" 라는 4개의 entity들이 존재하고, input 창에 "@pro" 라는 문자열이 입력될 경우, 엔티티 추천 섹션에 "project1", "project2", "project3"와 같이 3개의 엔티티가 추천된다. 즉, 유저가 입력한 내용으로 시작하는 entity의 이름을 모두 select한다.
    - 유저가 추천된 목록 중 하나를 클릭하면, 해당 내용으로 `@` 뒤의 문자열을 자동완성한다.
- 유저가 입력한 내용으로 시작하는 entity가 단 하나도 존재하지 않는 경우, 해당 문자열을 흐릿하게 처리하여 유저가 해당 이름의 entity가 부재한다는 사실을 알아차릴 수 있도록 함.
    - 유저가 흐릿한 글씨를 클릭하면 모달창을 띄워 "해당 이름의 entity를 새로 생성할 것인가"를 질의. 유저로부터 생성하라는 응답이 오면 DB의 entity 테이블에 추가.
    - 흐릿한 글씨, 즉 유저가 입력한 내용으로 시작하는 entity가 하나도 존재하지 않는 상태에서 유저가 입력을 마치려고 할 경우, 해당 요청을 처리하기 전 다시 한 번 같은 내용의 모달창을 띄운다. 유저가 해당 entity의 생성을 거절할 경우 memo를 저장할 수 없다는 내용을 안내한다. (즉, memo에 명시된 entity는 모두 반드시 존재해야 한다.)
- 유저가 `@` 뒤에 입력한 내용으로 로컬에 캐싱된 데이터 중 select 되는 entity가 단 하나인 경우, memo_entity 테이블을 조회하여 해당 entity가 포함된 memo들을 알아낸 뒤, 해당 memo들의 내용을 히스토리 섹션에 보여줌.

## DB 설계

---

- 총 4개의 Table로 구성. user, memo, entity, memo_entity
- user 테이블은 이용자 정보를 저장.
- memo 테이블은 memo의 정보를 저장.
- entity 테이블은 entity의 정보를 저장.
- memo_entity 테이블은 memo와 entity 간의 다대다 관계를 저장.


C:\Users\wondo\dev\unlooped-mvp\types\supabase.ts 

타입은 이걸 참고할 것. 